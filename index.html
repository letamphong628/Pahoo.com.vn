<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pahoo Messenger</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js"></script>
</head>
<body>
    <h1>Pahoo Messenger</h1>

    <!-- Form đăng nhập -->
    <div id="loginForm">
        <h3>Đăng nhập</h3>
        <input type="email" id="loginEmail" placeholder="Email">
        <input type="password" id="loginPassword" placeholder="Mật khẩu">
        <button id="loginButton">Đăng nhập</button>
        <p>Bạn chưa có tài khoản? <a href="#" id="showSignUpForm">Đăng ký</a></p>
    </div>

    <!-- Form đăng ký -->
    <div id="signUpForm" style="display:none;">
        <h3>Đăng ký</h3>
        <input type="email" id="signUpEmail" placeholder="Email">
        <input type="password" id="signUpPassword" placeholder="Mật khẩu">
        <button id="signUpButton">Đăng ký</button>
        <p>Đã có tài khoản? <a href="#" id="showLoginForm">Đăng nhập</a></p>
    </div>

    <!-- Chatbox -->
    <div id="chatBox" style="display:none;">
        <button id="logoutButton">Đăng xuất</button>
        <input type="text" id="messageInput" placeholder="Nhập tin nhắn...">
        <button id="sendMessage">Gửi</button>
        <div id="messageBox"></div>
    </div>

    <script>
        // Cấu hình Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBU0ycoLru5ZUZsKFKskJ_PrKFYvf1PXfg",
            authDomain: "pahoo-b33c0.firebaseapp.com",
            projectId: "pahoo-b33c0",
            storageBucket: "pahoo-b33c0.firebasestorage.app",
            messagingSenderId: "250563387030",
            appId: "1:250563387030:web:b128786f2172d57445acb7",
            measurementId: "G-KEBBHMXV7H"
        };

        // Khởi tạo Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM elements
        const loginForm = document.getElementById("loginForm");
        const signUpForm = document.getElementById("signUpForm");
        const chatBox = document.getElementById("chatBox");
        const messageInput = document.getElementById("messageInput");
        const messageBox = document.getElementById("messageBox");
        const loginEmail = document.getElementById("loginEmail");
        const loginPassword = document.getElementById("loginPassword");
        const signUpEmail = document.getElementById("signUpEmail");
        const signUpPassword = document.getElementById("signUpPassword");
        const loginButton = document.getElementById("loginButton");
        const signUpButton = document.getElementById("signUpButton");
        const logoutButton = document.getElementById("logoutButton");

        // Đăng ký tài khoản
        signUpButton.addEventListener("click", () => {
            const email = signUpEmail.value;
            const password = signUpPassword.value;

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    console.log("Đăng ký thành công:", userCredential.user);
                    signUpEmail.value = "";
                    signUpPassword.value = "";
                    alert("Đăng ký thành công! Bạn có thể đăng nhập ngay.");
                    showLoginForm();
                })
                .catch((error) => {
                    alert("Lỗi: " + error.message);
                });
        });

        // Đăng nhập tài khoản
        loginButton.addEventListener("click", () => {
            const email = loginEmail.value;
            const password = loginPassword.value;

            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    console.log("Đăng nhập thành công:", userCredential.user);
                    loginEmail.value = "";
                    loginPassword.value = "";
                    loginForm.style.display = "none";
                    chatBox.style.display = "block";
                })
                .catch((error) => {
                    alert("Lỗi: " + error.message);
                });
        });

        // Đăng xuất
        logoutButton.addEventListener("click", () => {
            auth.signOut().then(() => {
                loginForm.style.display = "block";
                chatBox.style.display = "none";
                alert("Đăng xuất thành công");
            });
        });

        // Gửi tin nhắn
        document.getElementById("sendMessage").addEventListener("click", () => {
            const message = messageInput.value.trim();
            if (message) {
                db.collection("messages").add({
                    message: message,
                    user: auth.currentUser.email,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                messageInput.value = "";
            }
        });

        // Lắng nghe tin nhắn
        db.collection("messages").orderBy("timestamp")
            .onSnapshot((snapshot) => {
                messageBox.innerHTML = "";
                snapshot.forEach((doc) => {
                    const msg = doc.data();
                    const msgElement = document.createElement("div");
                    msgElement.textContent = `${msg.user}: ${msg.message}`;
                    messageBox.appendChild(msgElement);
                });
            });

        // Hiển thị form đăng nhập
        document.getElementById("showLoginForm").addEventListener("click", showLoginForm);
        // Hiển thị form đăng ký
        document.getElementById("showSignUpForm").addEventListener("click", showSignUpForm);

        function showLoginForm() {
            loginForm.style.display = "block";
            signUpForm.style.display = "none";
        }

        function showSignUpForm() {
            signUpForm.style.display = "block";
            loginForm.style.display = "none";
        }

    </script>
</body>
</html>
